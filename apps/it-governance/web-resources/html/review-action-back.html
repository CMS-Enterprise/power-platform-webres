<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      :root {
        --text: #323130;
        --muted: #5e5e5e;
        --border: #e6e6e6;
        --shadow2: 0 2px 6px rgba(0, 0, 0, 0.06);
        --link: #0f6cbd;
        --btnHover: #115ea3;
        --bg: #faf9f8;
        --cardBg: #ffffff;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-size: 14px;
        line-height: 1.428571429;
        color: var(--text);
        background: var(--bg);
      }
      .wrap {
        padding: 10px 12px;
      }
      .back {
        display: inline-flex;
        gap: 10px;
        align-items: center;
        color: var(--link);
        text-decoration: none;
        font-size: 14px;
      }
      .back:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <a class="back" href="#" id="backLink" aria-label="Back to Action Center">
        &#8592; <span>Cancel action and return to request</span>
      </a>
    </div>

    <script>
      function getFormWindow() {
        if (parent?.ActionCenter) {
          console.log("returning parent 1");
          return parent;
        }

        try {
          for (let i = 0; i < parent.frames.length; i++) {
            const w = parent.frames[i];
            if (w?.ActionCenter) {
              return w;
            } else {
              console.log("couldnt find a parent frame with the window?");
            }
          }
        } catch (e) {
          console.error("Unable to find parent frame?");
        }

        return null;
      }

      document.getElementById("backLink").addEventListener("click", (e) => {
        e.preventDefault();
        const formWindow = getFormWindow();
        if (!formWindow) {
          console.log("Could not locate form window (no Xrm.Page found)");
          return;
        }
        const ac = formWindow.ActionCenter;
        const formContext = formWindow.Xrm.Page;
        if (!ac?.selectAction) {
          console.log("ActionCenter not found on form window", formWindow);
          console.log("formWindow.ActionCenter =", formWindow.ActionCenter);
          return;
        }

        ac.reset(formContext);
      });
    </script>
  </body>
</html>
